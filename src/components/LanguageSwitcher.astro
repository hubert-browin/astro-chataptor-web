---
import { locales, localeNames, type Locale } from '../i18n/config';

interface Props {
  currentLang: Locale;
  slug: string;
}

const { currentLang, slug } = Astro.props;
---

<div class="relative language-switcher">
  <button
    class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-zinc-600 hover:text-zinc-900 transition-colors"
    aria-label="Select language"
  >
    {localeNames[currentLang]}
    <svg
      class="w-4 h-4 transition-transform dropdown-arrow"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M19 9l-7 7-7-7"
      />
    </svg>
  </button>

  <ul
    class="absolute right-0 mt-2 w-40 bg-white rounded-xl shadow-lg ring-1 ring-zinc-200 py-2 z-50 hidden dropdown-menu"
  >
    {locales.map((locale) => (
      <li>
        <a
          href={`/${locale}/${slug}`}
          hreflang={locale}
          class:list={[
            'block px-4 py-2 text-sm hover:bg-zinc-50 transition-colors',
            locale === currentLang
              ? 'text-zinc-900 font-semibold bg-zinc-50'
              : 'text-zinc-600',
          ]}
        >
          {localeNames[locale]}
        </a>
      </li>
    ))}
  </ul>
</div>

<script>
  document.querySelectorAll('.language-switcher').forEach((switcher) => {
    const btn = switcher.querySelector('button');
    const menu = switcher.querySelector('.dropdown-menu');
    const arrow = switcher.querySelector('.dropdown-arrow');

    btn?.addEventListener('click', () => {
      menu?.classList.toggle('hidden');
      arrow?.classList.toggle('rotate-180');
    });

    document.addEventListener('click', (e) => {
      if (!switcher.contains(e.target as Node)) {
        menu?.classList.add('hidden');
        arrow?.classList.remove('rotate-180');
      }
    });
  });
</script>
